<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body { font-family: 'Poppins', sans-serif; background-color: #1a1424; color: white; scroll-behavior: smooth; }
  .btn { background-color: #D4AF37; color: black; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; cursor: pointer; display: inline-block; text-align: center; }
  .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px #D4AF37; }
  .video-slide { max-width: 100%; border-radius: 0.5rem; box-shadow: 0 0 20px #000; }
  .discount-badge { background-color: #ff4d6d; color: white; padding: 0.2rem 0.5rem; font-size: 0.8rem; border-radius: 0.3rem; margin-left: 0.5rem; }
  .faq-question { font-weight: bold; margin-top: 1rem; }
  .footer-links a { color: #D4AF37; text-decoration: underline; }
</style>
</head>
<body>
<!-- Place this at the bottom, just before </body> -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kairah Studio Auth</title>
<script type="module" src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-[#2b1f38] text-white flex items-center justify-center min-h-screen">

<div class="max-w-md w-full p-6 bg-[#3D2C41] rounded-2xl shadow-lg">
  <h2 class="text-3xl font-bold text-[#D4AF37] text-center mb-6">Kairah Studio</h2>

  <!-- Tabs -->
  <div class="flex justify-around mb-6">
    <button id="signup-tab" class="text-[#D4AF37] font-semibold border-b-2 border-[#D4AF37]">Sign Up</button>
    <button id="login-tab" class="text-white font-semibold">Login</button>
  </div>

  <!-- Signup Form -->
  <form id="signup-form" class="flex flex-col gap-4">
    <input type="text" id="signup-name" placeholder="Name" class="p-3 rounded-lg bg-[#2b1f38] text-white" required>
    <input type="email" id="signup-email" placeholder="Email" class="p-3 rounded-lg bg-[#2b1f38] text-white" required>
    <input type="password" id="signup-password" placeholder="Password" class="p-3 rounded-lg bg-[#2b1f38] text-white" required>
    <button type="submit" class="p-3 rounded-lg bg-[#D4AF37] text-black font-bold">Sign Up</button>
    <p id="signup-status" class="text-center mt-2"></p>
  </form>

  <!-- Login Form -->
  <form id="login-form" class="flex flex-col gap-4 hidden">
    <input type="email" id="login-email" placeholder="Email" class="p-3 rounded-lg bg-[#2b1f38] text-white" required>
    <input type="password" id="login-password" placeholder="Password" class="p-3 rounded-lg bg-[#2b1f38] text-white" required>
    <button type="submit" class="p-3 rounded-lg bg-[#D4AF37] text-black font-bold">Login</button>
    <button type="button" id="forgot-password" class="text-sm text-[#E7D2CB] underline mt-2">Forgot Password?</button>
    <p id="login-status" class="text-center mt-2"></p>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "kairah-studio.firebaseapp.com",
  projectId: "kairah-studio",
  storageBucket: "kairah-studio.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID",
  measurementId: "YOUR_MEASUREMENT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Tabs
const signupTab = document.getElementById("signup-tab");
const loginTab = document.getElementById("login-tab");
const signupForm = document.getElementById("signup-form");
const loginForm = document.getElementById("login-form");

signupTab.addEventListener("click", () => {
  signupForm.classList.remove("hidden");
  loginForm.classList.add("hidden");
  signupTab.classList.add("text-[#D4AF37]", "border-b-2", "border-[#D4AF37]");
  loginTab.classList.remove("text-[#D4AF37]", "border-b-2", "border-[#D4AF37]");
});

loginTab.addEventListener("click", () => {
  loginForm.classList.remove("hidden");
  signupForm.classList.add("hidden");
  loginTab.classList.add("text-[#D4AF37]", "border-b-2", "border-[#D4AF37]");
  signupTab.classList.remove("text-[#D4AF37]", "border-b-2", "border-[#D4AF37]");
});

// SIGNUP
signupForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("signup-name").value;
  const email = document.getElementById("signup-email").value;
  const password = document.getElementById("signup-password").value;
  const statusEl = document.getElementById("signup-status");
  statusEl.textContent = "Creating account...";

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    await sendEmailVerification(user);
    statusEl.textContent = "✅ Account created! Check your email to verify.";
    signupForm.reset();
  } catch (err) {
    statusEl.textContent = `❌ ${err.message}`;
    console.error(err);
  }
});

// LOGIN
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("login-email").value;
  const password = document.getElementById("login-password").value;
  const statusEl = document.getElementById("login-status");
  statusEl.textContent = "Logging in...";

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    if (user.emailVerified) {
      statusEl.textContent = "✅ Login successful!";
      setTimeout(()=>{ window.location.href = "/video-tool"; }, 1000);
    } else {
      statusEl.textContent = "⚠️ Please verify your email first.";
    }
  } catch(err) {
    statusEl.textContent = `❌ ${err.message}`;
  }
});

// FORGOT PASSWORD
document.getElementById("forgot-password").addEventListener("click", async () => {
  const email = prompt("Enter your email for password reset:");
  if(email){
    try{
      await sendPasswordResetEmail(auth, email);
      alert("✅ Password reset email sent!");
    }catch(err){
      alert(`❌ ${err.message}`);
    }
  }
});

// AUTO REDIRECT if already logged in & verified
onAuthStateChanged(auth, (user)=>{
  if(user && user.emailVerified){
    window.location.href = "/video-tool";
  }
});
</script>
</body>
</html>
