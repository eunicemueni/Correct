<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body { font-family: 'Poppins', sans-serif; background-color: #1a1424; color: white; scroll-behavior: smooth; }
  .btn { background-color: #D4AF37; color: black; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; cursor: pointer; display: inline-block; text-align: center; }
  .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px #D4AF37; }
  .video-slide { max-width: 100%; border-radius: 0.5rem; box-shadow: 0 0 20px #000; }
  .discount-badge { background-color: #ff4d6d; color: white; padding: 0.2rem 0.5rem; font-size: 0.8rem; border-radius: 0.3rem; margin-left: 0.5rem; }
  .faq-question { font-weight: bold; margin-top: 1rem; }
  .footer-links a { color: #D4AF37; text-decoration: underline; }
</style>
</head>
<body><section id="signup" class="py-16 max-w-md mx-auto px-6">
  <h2 class="text-3xl font-bold text-center text-[#D4AF37] mb-8">Sign Up / Login</h2>
  <div class="bg-[#3D2C41] p-8 rounded-xl shadow-lg">
    <input type="email" id="email" placeholder="Email" class="w-full p-3 mb-4 rounded text-black">
    <input type="password" id="password" placeholder="Password" class="w-full p-3 mb-4 rounded text-black">
    <button id="signup-btn" class="btn w-full mb-2">Sign Up</button>
    <button id="login-btn" class="btn w-full mb-2">Login</button>
    <button id="google-login" class="btn w-full mb-2">Sign In with Google</button>
    <p class="mt-2 text-sm text-center text-[#D4AF37]">Forgot password? <a href="#">Reset here</a></p>
    <p class="mt-2 text-sm text-center text-[#ff4d6d]">Support: keishapoa@gmail.com</p>
  </div>
</section>
<!-- Place this at the bottom, just before </body> -->
    // -------------------- Prompt & Template Functions --------------------
function setPrompt(category) {
  document.getElementById('prompt-input').value = category + ' prompt example...';
}
function refinePrompt() {
  const input = document.getElementById('prompt-input');
  input.value = "Refined: " + input.value;
}
function applyTemplate(template) {
  document.getElementById('prompt-input').value = template + " cinematic template applied...";
}
function clearVideo() {
  document.getElementById('generated-video').style.display = "none";
  document.getElementById('regenerate-btn').classList.add('hidden');
  document.getElementById('download-btn').classList.add('hidden');
  document.getElementById('prompt-input').value = '';
  document.getElementById('photo-upload').value = '';
  document.getElementById('watermark-upload').value = '';
  document.getElementById('audio-select').value = 'None';
  document.getElementById('error-message').innerText = '';
}

// -------------------- Display Error Message --------------------
function showError(message) {
  let errorEl = document.getElementById('error-message');
  if(!errorEl) {
    errorEl = document.createElement('p');
    errorEl.id = 'error-message';
    errorEl.className = 'text-red-500 mt-2 font-semibold text-center';
    document.getElementById('video-preview').prepend(errorEl);
  }
  errorEl.innerText = message;
}

// -------------------- Generate Video --------------------
async function generateVideo(user) {
  try {
    if(!user) {
      showError('❌ Please sign in first to generate videos.');
      return;
    }
    const uid = user.uid;
    const plan = await getUserPlan(uid);

    const prompt = document.getElementById('prompt-input').value;
    const photos = document.getElementById('photo-upload').files;
    const model = document.getElementById('model-select').value;
    const resolution = document.getElementById('resolution-select').value;
    const length = document.getElementById('length-select').value;
    const watermark = document.getElementById('watermark-upload').files[0];
    const audio = document.getElementById('audio-select').value;

    if(!prompt && photos.length === 0) {
      showError('❌ Enter a prompt or upload at least one photo.');
      return;
    }

    if(plan === 'free' && length !== '6 sec (Free)') {
      showError('❌ Free users can only generate 6-second videos. Upgrade to Pro/Diamond for longer videos.');
      return;
    }

    document.getElementById('loading-text').classList.remove('hidden');
    document.getElementById('generated-video').style.display = 'none';
    document.getElementById('batch-progress').classList.remove('hidden');

    const totalBatch = (plan === 'pro' || plan === 'diamond') ? photos.length || 1 : 1;
    document.getElementById('total-batch').innerText = totalBatch;

    for(let i=0; i<totalBatch; i++){
      document.getElementById('current-batch').innerText = i+1;
      const videoUrl = await generateVideoBackend({
        prompt,
        photo: photos[i],
        model,
        resolution,
        length,
        audio,
        watermark: (plan === 'free') ? null : watermark
      });

      const videoEl = document.getElementById('generated-video');
      videoEl.src = videoUrl;
      videoEl.style.display = 'block';
      document.getElementById('regenerate-btn').classList.remove('hidden');
      document.getElementById('download-btn').classList.remove('hidden');

      if(plan === 'free') await incrementVideoCount(uid);
    }

    document.getElementById('batch-progress').classList.add('hidden');
    showError(''); // clear previous errors
  } catch(err) {
    showError('❌ Video generation failed. Try again in a few seconds.');
    console.error(err);
  } finally {
    document.getElementById('loading-text').classList.add('hidden');
  }
}
